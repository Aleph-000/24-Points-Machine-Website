# 24 Points Machine

> ——世界上最好的24点机器，又名 **海格尔机（Hegel）**

## 简介

24点是一个老少咸宜的游戏，对于给定的数字，玩家通过“注意到”得出值为24的算式，颇有意思。

作者在与朋友游玩的过程中逐渐不满足，使用1~100的5个数算出24，并可以使用根号、阶乘、对数等运算。

于是，我写了一个24点机器，可以遍历所有的组合（包括根号等运算符），输出所有得到24的表达式

---

## 24点游戏规则

使用给定的数字（每个数字用且仅用一次），构造表达式使结果等于24。

允许使用的符号：

* `+` `-` `*` `/` ：四则运算
* `sqrt(x)` ：根号
* `x!`：阶乘(其中`4!=24`由于极大降低游戏难度不允许使用)
* `lg(x)`：以 10 为底的对数
* `lb(x)`：以 2 为底的对数
* `log(a, b)`：对数，即`log_a(b)`

---

## 功能展示

**示例：** 用
$$114,514,19,19,8,10$$
计算24点。

**解答：**

$$\frac{114 + 514 - 8}{10} - (19 + 19) = 24$$

$$8\space \text{lb} \left( 19 + 19 - (10 + \sqrt{514 - 114}) \right) = 24 $$

$$\frac{\left( \left( \sqrt{8 + \frac{19}{19}} \right)! \right)!}{10 + \sqrt{514 - 114}} = 24$$

---

## 目录

* 功能特性
* 使用说明

  * 解题模式（solution）
  * 随机模式（random）
* 可调参数

---

## 功能特性

* 输入任意数量的整数（空格分隔），搜索是否可组成 24
* 目标值可更改，默认为`TARGET = 24`，可改成任意自然数
* 支持两种模式：

  * **解题模式**：对输入数字求解（可输出全部解/或找到一个就停，取决于编译参数）
  * **随机模式**：随机生成多组数字，逐组尝试并统计有解比例
* 内置可调参数：函数使用次数、最大嵌套深度、剪枝阈值、是否允许中间负数等
* 四则运算以外的符号可通过选择是否使用，也可更改最大使用次数、嵌套深度等

---

## 使用说明

程序是交互式命令行工具，启动后有两种模式：

### 1) 解题模式（solution，默认）

提示：

```
请输入数字（输入 random 进入随机模式）：
```

输入一行整数（空格分隔），例如：

```
3 3 8 8
```

程序将输出一个或多个解（取决于参数设置），若无解输出：

```
无解
```

切换到随机模式：

```
random
```

---

### 2) 随机模式（random）

提示：

```
输入模拟次数、数字个数、最小值、最大值（输入 solution 返回解题模式）：
```

例子(模拟100次4个1~13的数计算24点)：

```
100 4 1 13
```

程序会逐组打印随机数字，并给出是否有解；最后输出有解概率：

```
有解概率为X/T=...
```

返回解题模式：

```
solution
```
---

## 可调参数

源码顶部的“可调参数”区域可改变求解空间与性能行为，例如：

* `MAX_NEST`：最大函数嵌套深度（如 `sqrt(lg(100))` 算两层）
* `MAX_USE_*`：每种函数最多使用次数（sqrt/fact/lg/lb/log）
* `MAX_ABS_VAL`：中间整数结果剪枝阈值（越大越慢，越小越可能漏解）
* `MAX_FACT_ARG`：允许做阶乘的最大自变量
* `NO_NEGATIVE_INTERMEDIATE`：是否禁止中间负数（关闭会显著扩大搜索空间）
* `ONLY_ARITHMETIC`：若设为 `true`，只允许四则运算（禁用所有函数）
* `NORMAL_FIND_FIRST_ONLY`：解题模式是否找到一个解就停止
* `SKIP_EQUIV_DURING_SEARCH` / `SIMPLIFY_STEPS`：等价表达式归一化与跳过（提速用）

改动参数后需要重新编译。
